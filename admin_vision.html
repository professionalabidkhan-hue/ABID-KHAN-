<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Vision | Abid Khan Hub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #07090d; color: white; padding: 40px; }
        .vision-container { background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 30px; }
        .table { color: #4fc3f7; }
        .master-header { border-bottom: 2px solid #4fc3f7; padding-bottom: 10px; margin-bottom: 30px; }
    </style>
</head>
<body>
<div style="margin-bottom: 20px;">
    <input type="text" id="vaultSearch" placeholder="Search by Name, Email or Location..." 
           onkeyup="searchVault(this.value)" 
           style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-size: 16px;">
</div>
   <div style="display: flex; gap: 20px; margin-bottom: 30px;">
    <div class="card" style="background: #007BFF; color: white; padding: 20px; border-radius: 10px; flex: 1;">
        <h3>Total Members</h3>
        <h2 id="stat-total">0</h2>
    </div>
    <div class="card" style="background: #28a745; color: white; padding: 20px; border-radius: 10px; flex: 1;">
        <h3>Active Courses</h3>
        <h2 id="stat-dept">0</h2>
    </div>
    <div class="card" style="background: #ffc107; color: white; padding: 20px; border-radius: 10px; flex: 1;">
        <h3>Global Locations</h3>
        <h2 id="stat-loc">0</h2>
    </div>
</div>

<script>
    // --- MASTER DATA CACHE ---
    let masterStudentData = [];

    // --- PART 1: THE VISIONARY DATA STREAM ---
    async function loadStudentVault() {
        const tableBody = document.getElementById('student-table-body');
        const countDisplay = document.getElementById('stat-total'); // Links to your Vision Cards
        
        try {
            // STRIKING THE ORACLE BRIDGE
            const response = await fetch('https://your-freesql-domain.com/admin_data.php');
            masterStudentData = await response.json();

            renderTable(masterStudentData);
            
            // Update the Founder's Analytics Counter
            if(countDisplay) countDisplay.innerText = masterStudentData.length;
            
            console.log("SENTINEL: Vault Data Stream Complete. Total Members: " + masterStudentData.length);
        } catch (error) {
            console.error("Vision Error:", error);
            tableBody.innerHTML = '<tr><td colspan="7" style="color:red; text-align:center;">Sentinel Error: Data unreachable from Vault.</td></tr>';
        }
    }

    // --- PART 2: THE RENDERING ENGINE (MASTERY CODE) ---
    function renderTable(dataList) {
        const tableBody = document.getElementById('student-table-body');
        tableBody.innerHTML = ''; 

        dataList.forEach(student => {
            const row = `
                <tr>
                    <td>#${student.ID}</td>
                    <td><strong>${student.FULL_NAME}</strong></td>
                    <td>${student.EMAIL}</td>
                    <td><a href="https://wa.me/${student.WHATSAPP_NO}" target="_blank" style="color:green; text-decoration:none;">ðŸ“ž ${student.WHATSAPP_NO}</a></td>
                    <td><span class="badge" style="background:#eee; padding:5px; border-radius:4px;">${student.DEPARTMENT}</span></td>
                    <td><span class="location-tag" style="background:#007BFF; color:white; padding:3px 8px; border-radius:12px; font-size:0.8em;">${student.LOCATION}</span></td>
                    <td>${new Date(student.CREATED_AT).toLocaleDateString('en-GB')}</td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    }

    // --- PART 3: INSTANT SEARCH STRIKE (THE MASTER'S GRIP) ---
    function searchVault(query) {
        const filtered = masterStudentData.filter(student => 
            student.FULL_NAME.toLowerCase().includes(query.toLowerCase()) ||
            student.EMAIL.toLowerCase().includes(query.toLowerCase()) ||
            student.LOCATION.toLowerCase().includes(query.toLowerCase())
        );
        renderTable(filtered);
    }

    // --- PART 4: YOUR TREMENDOUS EXCEL EXPORT (CALIBRATED) ---
    function exportToExcel() {
        let table = document.querySelector("table");
        let rows = Array.from(table.rows);
        
        if (rows.length <= 1) {
            alert("SENTINEL: No data available in the Vault to export.");
            return;
        }

        let csvContent = rows.map(row => {
            let cols = Array.from(row.cells).map(cell => `"${cell.innerText.replace(/"/g, '""')}"`);
            return cols.join(",");
        }).join("\n");

        let blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        let link = document.createElement("a");
        let url = URL.createObjectURL(blob);
        
        link.setAttribute("href", url);
        link.setAttribute("download", "Abid_Hub_Master_List_" + new Date().toISOString().split('T')[0] + ".csv");
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // INITIALIZE ON LOAD
    window.onload = loadStudentVault;
</script>

</body>
</html>