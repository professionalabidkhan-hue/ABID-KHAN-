<script>
    // --- THE SOVEREIGN TRACE ---
    console.log("SENTINEL: Mastery Script Loaded and Ready.");

    // Wait for the DOM to be fully loaded before attaching commands
    document.addEventListener('DOMContentLoaded', () => {
        
        // 1. IDENTITY PREVIEW UPDATERS
        const nameInput = document.getElementById('name');
        const locInput = document.getElementById('location');
        const courseInput = document.getElementById('course');
        const roleInput = document.getElementById('role');

        nameInput.oninput = (e) => document.getElementById('preview-name').innerText = e.target.value || "Member Name";
        locInput.oninput = (e) => document.getElementById('preview-location').innerText = e.target.value || "---";
        courseInput.onchange = (e) => document.getElementById('preview-course').innerText = e.target.options[e.target.selectedIndex].text;
        roleInput.onchange = (e) => document.getElementById('preview-role').innerText = e.target.options[e.target.selectedIndex].text;

        // 2. THE MASTER SIGNUP STRIKE
        const signUpBtn = document.getElementById('SignUp');
        
        if (signUpBtn) {
            signUpBtn.onclick = async function() {
                console.log("STRIKE: Visionary initiated the SignUp Protocol.");
                
                const signupData = {
                    full_name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    password: document.getElementById('password').value,
                    whatsapp_no: document.getElementById('phone').value,
                    father_name: document.getElementById('father_name').value,
                    monthly_income: document.getElementById('monthly_income').value,
                    preferred_timing: document.getElementById('preferred_timing').value,
                    location: document.getElementById('location').value,
                    department: document.getElementById('course').value,
                    role: document.getElementById('role').value
                };

                // VALIDATION: The First Shield
                if(!signupData.email || !signupData.password) {
                    alert("SENTINEL: Email and Password are required to enter the Vault.");
                    return;
                }

                alert("COMMAND RECEIVED: Attempting Vault Entry...");

                try {
                    // --- THE SOVEREIGN BRIDGE ---
                    const response = await fetch('./connect_hub.php', {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json' 
                        },
                        body: JSON.stringify(signupData)
                    });

                    if (!response.ok) throw new Error('Network response was not ok');

                    const result = await response.json();
                    alert("SERVER RESPONSE: " + result.message);
                    
                    if(result.success) {
                        console.log("VAULT ENTRY SECURED.");
                        window.location.href = 'signin.html';
                    }
                    
                } catch (error) {
                    console.error("STRIKE ERROR:", error);
                    alert("SENTINEL NOTICE: The Bridge is blocked. \n1. Ensure XAMPP/WAMP is running. \n2. Open via http://localhost/...");
                }
            };
        } else {
            console.error("SENTINEL: Button ID 'SignUp' not found in HTML!");
        }
    });
</script>
